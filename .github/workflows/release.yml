name: CI Release

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:

    runs-on: ubuntu-latest
    env:
      ACTIONS_ALLOW_UNSECURE_COMMANDS: 'true'
    steps:
      - name: Decode Key
        id: android_keystore
        uses: timheuer/base64-to-file@v1.0.3
        with:
          fileName: 'keystore/key.jks'
          encodedString: /u3+7QAAAAIAAAABAAAAAQAGdXBsb2FkAAABfjrFjfUAAAUCMIIE/jAOBgorBgEEASoCEQEBBQAEggTqIH2mpU+V7tVSbwlWvMJFSu+E/0lYDg+TkfPKYIh/Rk7yNnsLtIyEyCVTZyJ4mAoUqLSgKnTnwRp+YMYFI/xQIPwfGBpz+JpVq7+6W9hLmbYlfs2PCVNE37TbE2axNZ2CEZ+orxLOjy+9pG28qzZ/AfgS7cotH3ZHMW0S3+EQKT5oRYYYSc+bEvzgZtco9SqK7PM+sLKxphpsMpg8qqqCF36rcC9fvstCuhWhBqqtpBDZsUoYUdYaPVSqf4cUfqdhA38CQWzmrbbYFIZRFYliTX0UuBb6PI1MX3AsXcE/CoYCocz8U8P9LsF+6qOkf322BLIwPcn22qjvkykaYIv9s9cuodk4AYl6Rv96eoYf/3unyArQEQIVIWkC5gsTMYKwtS2byzS+1hf11te1SsflyVf8fziuLoKx5yIB049buT1ZoBwG6LzjS7IaVGdnZUQDzGJCzZI8NXsAwVeZKZnMlJKs96ZVD1SwrzVRK12KZLZjraq/H7i740Bc+yg/KTgJomb97KgM2gRkrZnyqjFScAq0NgJNzm+iebUujQaBa+ZVAbdcrbFUKqoyL5HHCgpUN/f3S/mMN2VxXKXvtoc+Nq001YJDPgRmlkQUnkmOMEGzM2PO1rSKbQXC3TmTtcfeaQ7dr01HmAWr5k+4IGStjK0jylFadnZPeYu6hKphKUKp3b+2UCC5+rojsyEA3W3OHgjM+xgyQ0yRo+JnAh7eSjNjqSpxfhD6TMB7qIpD5hjXpC/qTpPtWmfQWiZGVhtQPmboWoHZ3lTlrb3FP0IoPLQZE/eUh+NaUpGpwExY38VlYvfCkbhRDTKqPYOsP7VwMOvk4pvCeGxJihELCIF8O+iUTrql9ap6PSqEENh2vDkhlBSoCGFy8h889G2HNKtjwghCQiToT77bnSdZ/N+yucTwhC7blAtUmKB19BfwozvTd52yIjHiAbNGkekLx9I5mBzGVs4SWs5KFE55HSw/6LgCyLlehYEXUNqPI4U1m3z7G7Gntd9Z+DGmeF4wxAIs1KFzrCb4nbGsF11OtSHCNvpvs7jeU2h5p+En06Emnn86AN+fMsIgG+HwSlivvZlvo7qMVa0ZVHj3KS8ZPfnurT7Y65AP2Ld5XwuZv/QHGJpeDlAFB03ECZlS60xwAId0ac8wVleRWaMHqjJxBdgo+t1iClujzmiyD6mgLzCrIzecYG+qbEcuNeA3zGxmz0/5OogAXApoPhhMP+0ktLw1+6yHvatBou98j18/j2hxHXH2iu05OYQHxOAAX3sqn3Al8uAYHejBkjfZG72NfZ8xibhEST91EniQdyuGLteVDGR2NAVL5LR0zMKW7ducbgh/YjcTuNnasPAABkkl3mJ2K68jWfkmFmU9+g9sAht6bMxMMUcZKdpmgJTNOmynCcKMM4GGTGoQij3nvp26KaqZyQRh0PkEem/uVm9GmguMG70FHe8pbLcdP/DArqfzf3FzOrw84uQFTDf11HG+xN7EPI1uMURIa1X5f98fj1e1YuYay5/LaAFpKwxC/sMzmqPfkKvd2c3MqXdrGajvEmL6JQdpEyi4ssAcLhuhvIg+6cDXDdPbux6BdkcxwYnVq7wPZ1WCASanRRCq9Rkxun5Ph3XQuOeQWdL3CloAj/lmJziCmZip6C7eKrno2ieAhF+HdIBla/QEvrujqwAAAAEABVguNTA5AAADpzCCA6MwggKLoAMCAQICBCaRb/UwDQYJKoZIhvcNAQELBQAwgYExCzAJBgNVBAYTAkxLMRkwFwYDVQQIExBXZXN0ZXJuIFByb3ZpbmNlMRMwEQYDVQQHEwpNYWhhcmFnYW1hMRMwEQYDVQQKEwpTTElJVCBGT1NTMRMwEQYDVQQLEwpTTElJVCBGT1NTMRgwFgYDVQQDEw9Ba2FsYW5rYSBQZXJlcmEwHhcNMjIwMTA4MTczODQzWhcNNDkwNTI2MTczODQzWjCBgTELMAkGA1UEBhMCTEsxGTAXBgNVBAgTEFdlc3Rlcm4gUHJvdmluY2UxEzARBgNVBAcTCk1haGFyYWdhbWExEzARBgNVBAoTClNMSUlUIEZPU1MxEzARBgNVBAsTClNMSUlUIEZPU1MxGDAWBgNVBAMTD0FrYWxhbmthIFBlcmVyYTCCASIwDQYJKoZIhvcNAQEBBQADggEPADCCAQoCggEBAKpj2AvDm/ide9bixuPLke/kn0TbD8CXbUty9C/DCIVi3TKCIoNuvwdRgyfv8g0OSce/QYMYJLPFqDtBn1E7HWjQWGQJrJ4+6dqgq9CEpwTBHHbFwJxWB/73YmFPjyT0qa6IOlVWW3u1Cnzphc1Fyz8WUkST4s7wnCBqzEsvqVm66wmEt3WjLIUZ9QL457JUFN3QZHQK5+nFzGFY5K1X0mkT2X9EbvJdznrQh2s8YJ+5cqMlm4eG62BwnjfdscBylai4OxXmHzrl64rtwgwLFn2cJdZ3VOVfyE4+me6axJWX2MKcsql9vLXN9RPCaKfBampL4FW5FrGmYrtXOUu9VasCAwEAAaMhMB8wHQYDVR0OBBYEFOAB+aVlfENgVgDgJdOQ93pWZn1UMA0GCSqGSIb3DQEBCwUAA4IBAQA8QiJBeM4zdB+Cl4mI+TZatiBArTuNU5sXlTRX4CR8gGsTDC8E2hEi1ci1qWbF1ZUAljdbOP8oYD3IAxaUAalcRjcN02+UmyIE0pcioQcL/PFDahFbzGQlu5NUxS537bzwMZ4dlwo3X9CtOfDTtpxivafM3hOHRbdmiaGQBow9Omkz3g/xFcIPpc+VQJmi8jV12618rO8MAyi4Pw2n8dnywQri7TI85MxGxBLCVWjYK7L/LW/yzbank8gG9Hlie0vXgMRIWJKva4Vbi9Tl/iM/3LFlFpJ7CW3PgaaHztiaZBp9BeajEJzTSQRjcy+P2tDgPYM7NgynX70TnhFIOXVe51vxCf++EGlhjM1WLMsMRYmNhWk=
      - uses: actions/upload-artifact@v2
        with:
          name: release-apk
          path: keystore/key.jks
      - uses: actions/checkout@v1
      - uses: actions/setup-java@v1
        with:
          java-version: '12.x'
      - uses: subosito/flutter-action@v1.1.1
        with:
          channel: 'stable'
        env:
          KEY_JKS: ${{ secrets.SLIIT_EATS_KEY_JKS }}
          KEY_PASSWORD: ${{ secrets.SLIIT_EATS_ALIAS_PASSWORD }}
          ALIAS_PASSWORD: ${{ secrets.SLIIT_EATS_KEY_PASSWORD }}
      - run: flutter upgrade
      - run: flutter build apk --release
      - uses: actions/upload-artifact@v2
        with:
          name: release-apk
          path: build/app/outputs/apk/release/app-release.apk